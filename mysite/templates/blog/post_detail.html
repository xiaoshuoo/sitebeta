{% extends 'base.html' %}

{% block content %}
<div class="min-h-screen bg-background animated-bg p-6">
    <div class="max-w-4xl mx-auto space-y-6">
        <!-- Пост -->
        <article class="glass-effect rounded-2xl p-8 hover-lift">
            <!-- Заголовок и мета-информация -->
            <header class="mb-8">
                <h1 class="text-3xl font-bold text-white mb-4">{{ post.title }}</h1>
                <div class="flex flex-wrap items-center text-sm text-gray-400 gap-4">
                    <a href="{% url 'blog:user_profile' username=post.author.username %}" 
                       class="flex items-center hover:text-primary-500 transition-colors">
                        {% if post.author.profile.avatar %}
                            <img src="{{ post.author.profile.avatar.url }}" 
                                 alt="{{ post.author.username }}" 
                                 class="w-8 h-8 rounded-full mr-2">
                        {% else %}
                            <div class="w-8 h-8 rounded-full bg-surface flex items-center justify-center mr-2">
                                <i class="fas fa-user text-primary-500"></i>
                            </div>
                        {% endif %}
                        {{ post.author.username }}
                    </a>
                    <span class="flex items-center">
                        <i class="fas fa-calendar text-primary-500/70 mr-2"></i>
                        {{ post.created_at|date:"d.m.Y" }}
                    </span>
                    <a href="{% url 'blog:category_detail' slug=post.category.slug %}" 
                       class="flex items-center hover:text-primary-500 transition-colors">
                        <i class="fas {{ post.category.icon }} text-primary-500/70 mr-2"></i>
                        {{ post.category.name }}
                    </a>
                    <div class="flex items-center space-x-4">
                        <span class="flex items-center" title="Просмотры">
                            <i class="fas fa-eye text-primary-500/70 mr-2"></i>
                            {{ post.views_count }}
                        </span>
                        <span class="flex items-center" title="Уникальные посетители">
                            <i class="fas fa-users text-primary-500/70 mr-2"></i>
                            {{ post.views.count }}
                        </span>
                    </div>
                </div>
            </header>

            <!-- Обложка -->
            {% if post.thumbnail %}
            <div class="mb-8">
                <img src="{{ post.thumbnail.url }}" 
                     alt="{{ post.title }}" 
                     class="w-full h-96 object-cover rounded-xl">
            </div>
            {% endif %}

            <!-- Контент -->
            <div class="prose prose-invert max-w-none">
                {{ post.content|safe }}
            </div>

            <!-- Теги -->
            {% if post.tags.exists %}
            <div class="mt-8 pt-8 border-t border-gray-700">
                <div class="flex flex-wrap gap-2">
                    {% for tag in post.tags.all %}
                    <a href="{% url 'blog:tag_detail' slug=tag.slug %}" 
                       class="px-3 py-1 bg-surface/30 text-gray-300 rounded-lg hover:bg-primary-500 hover:text-white transition-all">
                        #{{ tag.name }}
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Кнопки управления -->
            {% if user == post.author %}
            <div class="mt-8 pt-8 border-t border-gray-700 flex justify-between">
                <div class="space-x-4">
                    <a href="{% url 'blog:edit_post' pk=post.pk %}" 
                       class="px-4 py-2 bg-primary-500 text-white rounded-lg hover:bg-primary-600 transition-all inline-flex items-center">
                        <i class="fas fa-edit mr-2"></i>
                        Редактировать
                    </a>
                    <a href="{% url 'blog:delete_post' pk=post.pk %}" 
                       class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-all inline-flex items-center">
                        <i class="fas fa-trash-alt mr-2"></i>
                        Удалить
                    </a>
                </div>
                <a href="{% url 'blog:home' %}" 
                   class="px-4 py-2 bg-surface text-white rounded-lg hover:bg-surface/70 transition-all inline-flex items-center">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Назад
                </a>
            </div>
            {% endif %}

            <!-- Похожие посты -->
            {% if similar_posts %}
            <div class="mt-12 pt-8 border-t border-gray-700">
                <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                    <i class="fas fa-book-reader text-primary-500 mr-2"></i>
                    Похожие посты
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    {% for similar_post in similar_posts %}
                    <a href="{% url 'blog:post_detail' pk=similar_post.pk %}" 
                       class="glass-effect rounded-xl p-4 hover:bg-surface/50 transition-all group">
                        {% if similar_post.thumbnail %}
                        <img src="{{ similar_post.thumbnail.url }}" 
                             alt="{{ similar_post.title }}" 
                             class="w-full h-48 object-cover rounded-lg mb-4">
                        {% endif %}
                        <h4 class="text-lg font-semibold text-white group-hover:text-primary-500 transition-colors mb-2">
                            {{ similar_post.title }}
                        </h4>
                        <div class="flex items-center text-sm text-gray-400">
                            <span class="flex items-center mr-4">
                                <i class="fas fa-eye text-primary-500/70 mr-1"></i>
                                {{ similar_post.views_count }}
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-calendar text-primary-500/70 mr-1"></i>
                                {{ similar_post.created_at|date:"d.m.Y" }}
                            </span>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </article>
    </div>
</div>

<style>
    .glass-effect {
        background: rgba(45, 42, 61, 0.7);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .hover-lift {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .hover-lift:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(139, 92, 246, 0.2);
    }

    /* Стили для контента поста */
    .prose {
        color: #e2e8f0;
    }

    .prose h1, .prose h2, .prose h3, .prose h4 {
        color: white;
        margin-top: 2em;
        margin-bottom: 1em;
    }

    .prose p {
        margin-top: 1.25em;
        margin-bottom: 1.25em;
    }

    .prose a {
        color: #8b5cf6;
        text-decoration: none;
    }

    .prose a:hover {
        text-decoration: underline;
    }

    .prose img {
        border-radius: 0.75rem;
        margin: 2em 0;
    }

    .prose ul, .prose ol {
        margin: 1.25em 0;
        padding-left: 1.625em;
    }

    .prose li {
        margin: 0.5em 0;
    }

    .prose blockquote {
        border-left: 4px solid #8b5cf6;
        padding-left: 1em;
        margin: 1.5em 0;
        color: #9ca3af;
    }

    .prose code {
        background: rgba(139, 92, 246, 0.1);
        padding: 0.2em 0.4em;
        border-radius: 0.375rem;
        font-size: 0.875em;
    }

    .prose pre {
        background: rgba(45, 42, 61, 0.7);
        padding: 1em;
        border-radius: 0.75rem;
        overflow-x: auto;
        margin: 1.5em 0;
    }

    .prose pre code {
        background: none;
        padding: 0;
    }
</style>
{% endblock %} 